<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Alagamentos - Protótipo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .header {
            background-color: #2c5aa0;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
        }

        .nav {
            background-color: #f8f9fa;
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .nav-item {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-right: 1px solid #ddd;
            background: none;
            border-top: none;
            border-bottom: none;
            border-left: none;
        }

        .nav-item:last-child {
            border-right: none;
        }

        .nav-item:hover {
            background-color: #e9ecef;
        }

        .nav-item.active {
            background-color: #2c5aa0;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Mapa */
        .map-container {
            border: 2px solid #ccc;
            height: 400px;
            margin-bottom: 20px;
            background-color: #e6f3ff;
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
            height: 100%;
            gap: 1px;
        }

        .map-area {
            background-color: #90EE90;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #666;
        }

        .map-area.alagado-leve {
            background-color: #FFD700;
        }

        .map-area.alagado-medio {
            background-color: #FFA500;
        }

        .map-area.alagado-severo {
            background-color: #FF4500;
            color: white;
        }

        .map-area.bloqueado {
            background-color: #DC143C;
            color: white;
        }

        .legenda {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            font-size: 14px;
        }

        .legenda-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .cor {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
        }

        /* Formulários */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .btn {
            background-color: #2c5aa0;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            background-color: #1e3f72;
        }

        /* Rota */
        .rota-resultado {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .rota-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .alerta {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 4px;
            margin: 15px 0;
        }

        /* Histórico */
        .historico-item {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-left: 4px solid #28a745;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .historico-item.medio {
            border-left-color: #ffc107;
        }

        .historico-item.alto {
            border-left-color: #dc3545;
        }

        .data {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        /* Estatísticas */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .stat-box {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
        }

        .stat-numero {
            font-size: 32px;
            font-weight: bold;
            color: #2c5aa0;
        }

        /* Defesa Civil */
        .emergencia {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .botoes {
            margin-top: 10px;
        }

        .btn-pequeno {
            padding: 6px 12px;
            font-size: 12px;
            margin-right: 10px;
        }

        .btn-vermelho {
            background-color: #dc3545;
        }

        .btn-amarelo {
            background-color: #ffc107;
            color: #333;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
            }
            
            .legenda {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .rota-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mapa de Alagamentos na Cidade</h1>
            <p>Sistema colaborativo para monitoramento de enchentes</p>
        </div>

        <div class="nav">
            <button class="nav-item active" onclick="mostrarTela('mapa')">Mapa</button>
            <button class="nav-item" onclick="mostrarTela('registro')">Registrar</button>
            <button class="nav-item" onclick="mostrarTela('rotas')">Rotas</button>
            <button class="nav-item" onclick="mostrarTela('historico')">Histórico</button>
            <button class="nav-item" onclick="mostrarTela('defesa-civil')">Defesa Civil</button>
        </div>

        <div class="content">
            <!-- Tela Mapa -->
            <div id="mapa" class="screen active">
                <h2>Mapa em Tempo Real</h2>
                
                <div class="map-container">
                    <div class="map-grid" id="mapaGrid">
                        <!-- Grid será gerado dinamicamente -->
                    </div>
                </div>

                <div class="legenda">
                    <div class="legenda-item">
                        <div class="cor" style="background-color: #90EE90;"></div>
                        <span>Normal</span>
                    </div>
                    <div class="legenda-item">
                        <div class="cor" style="background-color: #FFD700;"></div>
                        <span>Alagamento Leve</span>
                    </div>
                    <div class="legenda-item">
                        <div class="cor" style="background-color: #FFA500;"></div>
                        <span>Alagamento Médio</span>
                    </div>
                    <div class="legenda-item">
                        <div class="cor" style="background-color: #FF4500;"></div>
                        <span>Alagamento Severo</span>
                    </div>
                    <div class="legenda-item">
                        <div class="cor" style="background-color: #DC143C;"></div>
                        <span>Bloqueado</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Buscar localização:</label>
                    <input type="text" id="buscaLocal" placeholder="Digite o nome da rua ou bairro...">
                </div>
            </div>

            <!-- Tela Registro -->
            <div id="registro" class="screen">
                <h2>Registrar Ocorrência</h2>
                
                <form id="formRegistro" onsubmit="return enviarOcorrencia(event)">
                    <div class="form-group">
                        <label>Localização:</label>
                        <input type="text" id="localizacao" placeholder="Rua, número, bairro..." required>
                        <small>Localização GPS detectada automaticamente</small>
                    </div>

                    <div class="form-group">
                        <label>Tipo de alagamento:</label>
                        <select id="tipoAlagamento" required>
                            <option value="">Selecione...</option>
                            <option value="leve">Leve - Água até a sarjeta</option>
                            <option value="medio">Médio - Água na metade da rua</option>
                            <option value="severo">Severo - Água cobrindo a rua</option>
                            <option value="bloqueado">Bloqueado - Intransitável</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Descrição (opcional):</label>
                        <textarea id="descricao" rows="4" placeholder="Detalhes sobre a situação..."></textarea>
                    </div>

                    <button type="submit" class="btn">Enviar Ocorrência</button>
                </form>

                <div class="alerta" id="sucesso" style="display: none; background-color: #d4edda; color: #155724;">
                    Ocorrência registrada com sucesso! Obrigado por contribuir.
                </div>
            </div>

            <!-- Tela Rotas -->
            <div id="rotas" class="screen">
                <h2>Consulta de Rotas Seguras</h2>
                
                <div class="form-group">
                    <label>Origem:</label>
                    <input type="text" id="origem" placeholder="Endereço de partida..." required>
                </div>

                <div class="form-group">
                    <label>Destino:</label>
                    <input type="text" id="destino" placeholder="Endereço de chegada..." required>
                </div>

                <button class="btn" onclick="calcularRota()">Calcular Rota Segura</button>

                <div class="rota-resultado" id="rotaResultado">
                    <div class="rota-info">
                        <span>Tempo estimado: 15 min</span>
                        <span>Distância: 8.5 km</span>
                    </div>
                    
                    <div class="alerta">
                        ⚠ Rota alternativa sugerida evitando 2 áreas alagadas
                    </div>
                </div>
            </div>

            <!-- Tela Histórico -->
            <div id="historico" class="screen">
                <h2>Histórico de Alagamentos</h2>
                
                <div class="form-group">
                    <label>Filtrar por bairro:</label>
                    <select id="filtroBairro" onchange="filtrarHistorico()">
                        <option value="">Todos os bairros</option>
                        <option value="centro">Centro</option>
                        <option value="jardins">Jardins</option>
                        <option value="vila-nova">Vila Nova</option>
                        <option value="industrial">Industrial</option>
                    </select>
                </div>

                <div id="listaHistorico">
                    <!-- Histórico será carregado dinamicamente -->
                </div>

                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-numero" id="totalOcorrencias">0</div>
                        <div>Ocorrências este mês</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-numero">85%</div>
                        <div>Taxa de resolução</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-numero">12min</div>
                        <div>Tempo médio resposta</div>
                    </div>
                </div>
            </div>

            <!-- Tela Defesa Civil -->
            <div id="defesa-civil" class="screen">
                <h2>Painel da Defesa Civil</h2>
                
                <div class="stats" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="stat-box">
                        <div class="stat-numero" id="ocorrenciasAtivas">0</div>
                        <div>Ocorrências Ativas</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-numero">3</div>
                        <div>Equipes em Campo</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-numero" id="alertasHoje">0</div>
                        <div>Alertas Hoje</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-numero">92%</div>
                        <div>Eficácia</div>
                    </div>
                </div>

                <h3>Ocorrências Prioritárias</h3>
                
                <div id="ocorrenciasPrioritarias">
                    <!-- Ocorrências serão carregadas dinamicamente -->
                </div>

                <div class="form-group">
                    <label>Enviar alerta geral:</label>
                    <textarea id="textoAlerta" rows="3" placeholder="Digite o alerta para a população..."></textarea>
                    <br><br>
                    <button class="btn" onclick="enviarAlerta()">Enviar Alerta</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados dos bairros
        const bairros = [
            'Centro', 'Jardins', 'Vila Nova', 'Industrial', 'Residencial', 'Comercial',
            'Zona Norte', 'Zona Sul', 'Vila Rica', 'Boa Vista', 'Liberdade', 'Saúde',
            'Lapa', 'Pinheiros', 'Vila Madalena', 'Santana', 'Tatuapé', 'Penha',
            'Ipiranga', 'Morumbi', 'Bela Vista', 'Tucuruvi', 'Campo Limpo', 'Jaçanã'
        ];

        // Inicializar LocalStorage se vazio
        function inicializarDados() {
            if (!localStorage.getItem('ocorrencias')) {
                localStorage.setItem('ocorrencias', JSON.stringify([]));
            }
            if (!localStorage.getItem('statusBairros')) {
                const statusInicial = {};
                bairros.forEach(b => statusInicial[b] = 'normal');
                // Alguns alagamentos iniciais para demonstração
                statusInicial['Industrial'] = 'alagado-medio';
                statusInicial['Zona Sul'] = 'alagado-severo';
                statusInicial['Liberdade'] = 'alagado-leve';
                statusInicial['Santana'] = 'alagado-medio';
                statusInicial['Bela Vista'] = 'bloqueado';
                localStorage.setItem('statusBairros', JSON.stringify(statusInicial));
            }
        }

        // Carregar mapa
        function carregarMapa() {
            const grid = document.getElementById('mapaGrid');
            const status = JSON.parse(localStorage.getItem('statusBairros'));
            grid.innerHTML = '';
            
            bairros.forEach(bairro => {
                const div = document.createElement('div');
                div.className = `map-area ${status[bairro]}`;
                div.textContent = bairro;
                grid.appendChild(div);
            });
        }

        // Mostrar tela
        function mostrarTela(tela) {
            document.querySelectorAll('.screen').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tela).classList.add('active');
            event.target.classList.add('active');
            
            if (tela === 'historico') carregarHistorico();
            if (tela === 'defesa-civil') carregarDefesaCivil();
            if (tela === 'mapa') carregarMapa();
        }
        
        // Enviar ocorrência
        function enviarOcorrencia(event) {
            event.preventDefault();
            
            const ocorrencia = {
                id: Date.now(),
                localizacao: document.getElementById('localizacao').value,
                tipo: document.getElementById('tipoAlagamento').value,
                descricao: document.getElementById('descricao').value,
                data: new Date().toLocaleString('pt-BR'),
                status: 'Ativo'
            };
            
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias'));
            ocorrencias.unshift(ocorrencia);
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            
            document.getElementById('sucesso').style.display = 'block';
            document.getElementById('formRegistro').reset();
            
            setTimeout(() => {
                document.getElementById('sucesso').style.display = 'none';
            }, 3000);
            
            return false;
        }
        
        // Calcular rota
        function calcularRota() {
            const origem = document.getElementById('origem').value;
            const destino = document.getElementById('destino').value;
            
            if (origem && destino) {
                document.getElementById('rotaResultado').style.display = 'block';
            }
        }

        // Carregar histórico
        function carregarHistorico() {
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias'));
            const lista = document.getElementById('listaHistorico');
            
            lista.innerHTML = '';
            
            if (ocorrencias.length === 0) {
                lista.innerHTML = '<p>Nenhuma ocorrência registrada ainda.</p>';
            } else {
                ocorrencias.forEach(oc => {
                    const classe = oc.tipo === 'severo' || oc.tipo === 'bloqueado' ? 'alto' : 
                                   oc.tipo === 'medio' ? 'medio' : '';
                    
                    const div = document.createElement('div');
                    div.className = `historico-item ${classe}`;
                    div.innerHTML = `
                        <div class="data">${oc.data}</div>
                        <strong>${oc.localizacao}</strong>
                        <p>${oc.descricao || 'Sem descrição adicional'}</p>
                        <small>Tipo: ${oc.tipo} • Status: ${oc.status}</small>
                    `;
                    lista.appendChild(div);
                });
            }
            
            document.getElementById('totalOcorrencias').textContent = ocorrencias.length;
        }

        // Filtrar histórico
        function filtrarHistorico() {
            const filtro = document.getElementById('filtroBairro').value;
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias'));
            const lista = document.getElementById('listaHistorico');
            
            lista.innerHTML = '';
            
            const filtradas = filtro ? 
                ocorrencias.filter(oc => oc.localizacao.toLowerCase().includes(filtro)) : 
                ocorrencias;
            
            if (filtradas.length === 0) {
                lista.innerHTML = '<p>Nenhuma ocorrência encontrada.</p>';
            } else {
                filtradas.forEach(oc => {
                    const classe = oc.tipo === 'severo' || oc.tipo === 'bloqueado' ? 'alto' : 
                                   oc.tipo === 'medio' ? 'medio' : '';
                    
                    const div = document.createElement('div');
                    div.className = `historico-item ${classe}`;
                    div.innerHTML = `
                        <div class="data">${oc.data}</div>
                        <strong>${oc.localizacao}</strong>
                        <p>${oc.descricao || 'Sem descrição adicional'}</p>
                        <small>Tipo: ${oc.tipo} • Status: ${oc.status}</small>
                    `;
                    lista.appendChild(div);
                });
            }
        }

        // Carregar painel Defesa Civil
        function carregarDefesaCivil() {
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias'));
            const ativas = ocorrencias.filter(oc => oc.status === 'Ativo');
            
            document.getElementById('ocorrenciasAtivas').textContent = ativas.length;
            document.getElementById('alertasHoje').textContent = ativas.length;
            
            const container = document.getElementById('ocorrenciasPrioritarias');
            container.innerHTML = '';
            
            if (ativas.length === 0) {
                container.innerHTML = '<p>Nenhuma ocorrência ativa no momento.</p>';
            } else {
                ativas.slice(0, 3).forEach(oc => {
                    const bg = oc.tipo === 'severo' || oc.tipo === 'bloqueado' ? '#f8d7da' : '#fff3cd';
                    const div = document.createElement('div');
                    div.className = 'emergencia';
                    div.style.backgroundColor = bg;
                    div.innerHTML = `
                        <div class="data">ATIVO - ${oc.data}</div>
                        <strong>${oc.localizacao}</strong>
                        <p>${oc.descricao || 'Alagamento reportado'}</p>
                        <div class="botoes">
                            <button class="btn btn-pequeno btn-vermelho" onclick="resolverOcorrencia(${oc.id})">Resolver</button>
                            <button class="btn btn-pequeno btn-amarelo">Atualizar</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        }

        // Resolver ocorrência
        function resolverOcorrencia(id) {
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias'));
            const index = ocorrencias.findIndex(oc => oc.id === id);
            if (index !== -1) {
                ocorrencias[index].status = 'Resolvido';
                localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                carregarDefesaCivil();
            }
        }

        // Enviar alerta
        function enviarAlerta() {
            const texto = document.getElementById('textoAlerta').value;
            if (texto) {
                alert('Alerta enviado para a população:\n\n' + texto);
                document.getElementById('textoAlerta').value = '';
            }
        }

        // Inicializar ao carregar página
        window.onload = function() {
            inicializarDados();
            carregarMapa();
        };
    </script>
</body>
</html>
